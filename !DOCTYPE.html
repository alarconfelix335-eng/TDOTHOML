<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Para Frida ‚ù§Ô∏è</title>
<style>
    body {
        margin: 0;
        background: radial-gradient(circle at top, #1a001f, #000);
        overflow: hidden;
        font-family: 'Segoe UI', sans-serif;
    }
    canvas { display: block; }
</style>
</head>
<body>

<canvas id="canvas"></canvas>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

canvas.width = innerWidth;
canvas.height = innerHeight;
ctx.translate(canvas.width / 2, canvas.height / 2);

let t = 0;
let pulse = 0;
let phase = "heart";

const heartParticles = [];
const flowerTargets = [];
const animatedFlowers = [];

/* ‚ù§Ô∏è ECUACI√ìN CORAZ√ìN */
function heart(a) {
    return {
        x: 16 * Math.pow(Math.sin(a), 3),
        y: -(13 * Math.cos(a)
            - 5 * Math.cos(2 * a)
            - 2 * Math.cos(3 * a)
            - Math.cos(4 * a))
    };
}

/* üå∏ FLOR */
function drawFlower(x, y, size, alpha = 1) {
    ctx.save();
    ctx.globalAlpha = alpha;
    ctx.translate(x, y);
    ctx.fillStyle = "#ff8fb1";

    for (let i = 0; i < 5; i++) {
        ctx.rotate(Math.PI * 2 / 5);
        ctx.beginPath();
        ctx.ellipse(0, size, size * 0.7, size * 1.3, 0, 0, Math.PI * 2);
        ctx.fill();
    }

    ctx.fillStyle = "#ffd6e0";
    ctx.beginPath();
    ctx.arc(0, 0, size * 0.5, 0, Math.PI * 2);
    ctx.fill();
    ctx.restore();
}

/* ‚ù§Ô∏è BOLITAS DEL CORAZ√ìN */
function createHeartParticle(x, y) {
    heartParticles.push({
        x, y,
        vx: (Math.random() - 0.5) * 0.8,
        vy: (Math.random() - 0.5) * 0.8,
        life: 100
    });
}

function drawHeartParticles() {
    heartParticles.forEach((p, i) => {
        ctx.fillStyle = "#ff2f5e";
        ctx.globalAlpha = p.life / 100;
        ctx.beginPath();
        ctx.arc(p.x, p.y, 2.2, 0, Math.PI * 2);
        ctx.fill();

        p.x += p.vx;
        p.y += p.vy;
        p.life--;
        if (p.life <= 0) heartParticles.splice(i, 1);
    });
    ctx.globalAlpha = 1;
}

/* üå∏ PREPARAR TEXTO */
function prepareFlowerText(text) {
    const off = document.createElement("canvas");
    off.width = 1100;
    off.height = 300;
    const o = off.getContext("2d");

    o.fillStyle = "#fff";
    o.font = "bold 140px Segoe UI";
    o.textAlign = "center";
    o.fillText(text, off.width / 2, off.height / 1.6);

    const img = o.getImageData(0, 0, off.width, off.height);

    for (let y = 0; y < off.height; y += 20) {
        for (let x = 0; x < off.width; x += 20) {
            const i = (y * off.width + x) * 4;
            if (img.data[i + 3] > 150) {
                flowerTargets.push({
                    x: x - off.width / 2,
                    y: y + 160,
                    size: 4 + Math.random()
                });
            }
        }
    }
}

/* üå∏ ANIMAR FLORES */
function spawnFlower() {
    if (flowerTargets.length === 0) return;

    const target = flowerTargets.shift();
    animatedFlowers.push({
        x: (Math.random() - 0.5) * canvas.width,
        y: canvas.height / 2 + 250,
        tx: target.x,
        ty: target.y,
        size: target.size,
        progress: 0
    });
}

function drawFlowers() {
    animatedFlowers.forEach(f => {
        f.progress += 0.02;
        if (f.progress > 1) f.progress = 1;

        const x = f.x + (f.tx - f.x) * f.progress;
        const y = f.y + (f.ty - f.y) * f.progress;

        drawFlower(x, y, f.size, 1);
    });
}

/* ‚ù§Ô∏è CORAZ√ìN PALPITANDO */
function drawHeart() {
    pulse += 0.04;
    const scale = 15 + Math.sin(pulse) * 0.6;

    ctx.strokeStyle = "#ff5c8a";
    ctx.lineWidth = 3;
    ctx.beginPath();

    for (let i = 0; i <= Math.PI * 2; i += 0.015) {
        const p = heart(i);
        const x = p.x * scale;
        const y = p.y * scale;
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);

        if (Math.random() < 0.08) createHeartParticle(x, y);
    }
    ctx.stroke();
}

function draw() {
    ctx.clearRect(-canvas.width, -canvas.height, canvas.width * 2, canvas.height * 2);

    drawHeart();              // ‚ù§Ô∏è siempre vivo
    drawHeartParticles();     // üî¥ bolitas rojas

    if (phase === "heart") {
        t += 0.01;
        if (t >= Math.PI * 2) {
            phase = "text";
            prepareFlowerText("TE AMO FRIDA");
        }
    }

    if (phase === "text" && Math.random() < 0.25) {
        spawnFlower();
    }

    drawFlowers();
    requestAnimationFrame(draw);
}

draw();

addEventListener("resize", () => {
    canvas.width = innerWidth;
    canvas.height = innerHeight;
    ctx.setTransform(1,0,0,1,0,0);
    ctx.translate(canvas.width / 2, canvas.height / 2);
});
</script>

</body>
</html>
